<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Csal√°di Napl√≥ (Felh≈ë)</title>
    
    <style>
        :root { --main: #6c5ce7; --accent: #00cec9; --bg: #dfe6e9; --danger: #ff7675; --text: #2d3436; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: var(--bg); color: var(--text); padding-bottom: 80px; user-select: none; }
        
        /* LOGIN */
        #login-screen { position: fixed; inset: 0; background: var(--main); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; padding: 20px; overflow-y: auto; }
        .login-box { background: white; padding: 25px; border-radius: 12px; width: 100%; max-width: 350px; text-align: center; color: #333; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .login-box input { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #eee; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .login-box label { font-size: 0.8rem; color: #888; display: block; text-align: left; margin-top: 10px; }
        
        /* √öJ: √öTMUTAT√ì ST√çLUS */
        .intro-steps { background: #f0f3f7; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: left; font-size: 0.9rem; line-height: 1.5; }
        .intro-steps b { color: var(--main); }
        .step-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 8px; }
        .step-icon { background: var(--main); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; flex-shrink: 0; margin-top: 2px; }

        /* HEADER */
        header { background: white; padding: 15px; position: sticky; top:0; z-index:100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: flex-start; }
        .header-left { display: flex; flex-direction: column; }
        h1 { margin: 5px 0 0 0; font-size: 1.2rem; color: var(--text); font-weight: 800; }
        
        /* √öJ: PANTRY ID BADGE ST√çLUS */
        .pantry-id-badge { 
            background: var(--main); 
            color: white; 
            font-family: monospace; 
            font-size: 0.85rem; 
            padding: 4px 8px; 
            border-radius: 6px; 
            display: inline-block;
            font-weight: bold;
            margin-bottom: 2px;
            box-shadow: 0 2px 5px rgba(108, 92, 231, 0.3);
        }

        .sync-badge { font-size: 0.7rem; background: #eee; padding: 3px 8px; border-radius: 10px; color: #555; align-self: center; }
        .sync-badge.active { background: #55efc4; color: #006266; }
        
        /* LAYOUT */
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        .tab-content { display: none; animation: fadein 0.3s; }
        .tab-content.active { display: block; }

        /* K√ÅRTY√ÅK */
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.04); border-left: 5px solid #ccc; position: relative; }
        .status-todo { border-left-color: #fdcb6e; }
        .status-done { border-left-color: #00b894; background: #f0fff4; opacity: 0.8; }
        .status-skipped { border-left-color: #b2bec3; opacity: 0.6; filter: grayscale(100%); }

        .task-header { display: flex; justify-content: space-between; }
        .task-name { font-size: 1.1rem; font-weight: 700; color: #2d3436; }
        .task-detail { font-size: 0.8rem; color: #636e72; font-style: italic; margin-top: 4px; }
        
        /* GOMBOK */
        .btn-primary { background: var(--main); color: white; width: 100%; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1rem; }
        .btn-row { display: flex; gap: 8px; margin-top: 12px; }
        button { border: none; padding: 10px; border-radius: 6px; font-weight: bold; cursor: pointer; flex: 1; font-size: 0.9rem; transition: 0.2s; }
        .btn-done { background: #00b894; color: white; flex: 2; }
        .btn-plan { background: #dfe6e9; color: #2d3436; flex: 1; }
        .btn-skip { background: white; border: 1px solid #dfe6e9; color: #b2bec3; flex: 0.5; }
        .btn-danger { background: var(--danger); color: white; width: 100%; }

        /* INPUTOK */
        select, input[type="text"], input[type="number"] { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; background: white; font-size: 1rem; }
        
        .week-selector { display: flex; justify-content: space-between; gap: 4px; margin-bottom: 15px; }
        .day-btn { padding: 10px 0; flex: 1; text-align: center; border: 1px solid #ddd; border-radius: 6px; background: #fff; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        .day-btn.selected { background: var(--main); color: white; border-color: var(--main); }

        .date-nav { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 20px; }
        .nav-arrow { background: white; border: 1px solid #ddd; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem; }
        
        .chip-container { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; }
        .chip { background: #eee; padding: 6px 12px; border-radius: 15px; font-size: 0.85rem; cursor: pointer; }
        
        /* NAVBAR */
        nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #eee; display: flex; height: 70px; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #b2bec3; font-size: 0.75rem; }
        .nav-item.active { color: var(--main); font-weight: bold; }
        .nav-icon { font-size: 1.5rem; margin-bottom: 4px; }

        @keyframes fadein { from { opacity:0; transform: translateY(5px); } to { opacity:1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color:var(--main); margin-top:0;">‚òÅÔ∏è Csal√°di Napl√≥</h2>
        
        <div class="intro-steps">
            <div class="step-item">
                <div class="step-icon">1</div>
                <div><b>Egy csal√°d = Egy k√≥d.</b> Mindenki ugyanazt a Pantry k√≥dot haszn√°lja.</div>
            </div>
            <div class="step-item">
                <div class="step-icon">2</div>
                <div>Ha m√©g nincs, <b>egy valaki</b> k√©rjen k√≥dot a honlapon.</div>
            </div>
            <div class="step-item">
                <div class="step-icon">3</div>
                <div>√çrj√°tok be a k√≥dot √©s a saj√°t neveteket al√°bb.</div>
            </div>
        </div>

        <label>Te neved (pl. Apa, Anya)</label>
        <input type="text" id="user-name" placeholder="√çrd be a neved">
        
        <label>K√∂z√∂s Pantry (√âl√©skamra) K√≥d</label>
        <input type="text" id="pantry-id" placeholder="M√°sold ide a k√∂z√∂s k√≥dot">
        <div style="font-size:0.75rem; color:#888; margin-bottom:10px;">
            Nincs k√≥dod? <a href="https://getpantry.cloud/" target="_blank" style="color:var(--main)">K√©rj egyet ingyen itt (getpantry.cloud).</a>
        </div>

        <button class="btn-primary" onclick="login()">Bel√©p√©s</button>
    </div>
</div>

<div id="app" style="display:none;">
    <header>
        <div class="header-left">
            <div id="sticky-pantry-id" class="pantry-id-badge" onclick="alert('Ez a csal√°d k√∂z√∂s k√≥dja. Ezt √≠rja be a m√°sik csal√°dtag is!')">ID: -----</div>
            <h1>Csal√°di Napl√≥</h1>
            <div id="user-display" style="font-size:0.8rem; color:#666;"></div>
        </div>
        <div class="sync-badge" id="sync-status">Offline</div>
    </header>

    <div class="container">
        
        <div id="tab-today" class="tab-content active">
            <div class="date-nav">
                <button class="nav-arrow" onclick="changeDay(-1)">‚ùÆ</button>
                <div id="today-date" style="font-weight:bold; width:180px; text-align:center;"></div>
                <button class="nav-arrow" onclick="changeDay(1)">‚ùØ</button>
            </div>
            
            <div id="task-list"></div>
            
            <div id="empty-msg" style="text-align:center; color:#aaa; margin-top:60px; display:none;">
                <div style="font-size:3rem; margin-bottom:10px;">‚úÖ</div>
                <p>M√°ra minden k√©sz!</p>
            </div>
        </div>

        <div id="tab-settings" class="tab-content">
            <div class="card">
                <h3 style="margin-top:0;">‚ûï √öj feladat</h3>
                
                <label>Feladat Neve</label>
                <input type="text" id="new-name" placeholder="pl. Kuka kih√∫z√°sa">
                
                <label>Kateg√≥ria</label>
                <input type="text" id="new-cat" placeholder="pl. H√°zimunka..." oninput="filterCats()">
                <div id="cat-chips" class="chip-container"></div>

                <label>Gyakoris√°g</label>
                <select id="freq-type" onchange="renderFreqOptions()">
                    <option value="every_day">Minden nap</option>
                    <option value="weekly_days">Heti konkr√©t napok</option>
                    <option value="interval_week">Ciklikus (Minden X. h√©ten)</option>
                    <option value="monthly_fix">Havi fix napon</option>
                    <option value="interval_month">Ciklikus (Minden X. h√≥napban)</option>
                    <option value="monthly_pattern">Havi minta (pl. Els≈ë H√©tf≈ë)</option>
                </select>

                <div id="opt-weekly-days" style="display:none;">
                    <div class="week-selector">
                        <div class="day-btn" onclick="toggleDay(this)">H</div><div class="day-btn" onclick="toggleDay(this)">K</div><div class="day-btn" onclick="toggleDay(this)">Sz</div>
                        <div class="day-btn" onclick="toggleDay(this)">Cs</div><div class="day-btn" onclick="toggleDay(this)">P</div><div class="day-btn" onclick="toggleDay(this)">Sz</div><div class="day-btn" onclick="toggleDay(this)">V</div>
                    </div>
                </div>
                <div id="opt-interval-week" style="display:none;"><label>Minden X. h√©ten:</label><input type="number" id="interval-week-num" value="2" min="1"></div>
                <div id="opt-monthly-fix" style="display:none;"><label>H√°nyadik√°n:</label><input type="number" id="month-day-fix" min="1" max="31" value="10"></div>
                <div id="opt-interval-month" style="display:none;"><label>Minden X. h√≥napban:</label><input type="number" id="interval-month-num" value="3" min="1"></div>
                <div id="opt-monthly-pattern" style="display:none;">
                     <select id="month-pos-num"><option value="1">Els≈ë</option><option value="2">M√°sodik</option><option value="3">Harmadik</option><option value="4">Negyedik</option><option value="-1">Utols√≥</option></select>
                     <select id="month-pos-day"><option value="1">H√©tf≈ë</option><option value="2">Kedd</option><option value="3">Szerda</option><option value="4">Cs√ºt√∂rt√∂k</option><option value="5">P√©ntek</option><option value="6">Szombat</option><option value="0">Vas√°rnap</option></select>
                </div>

                <button class="btn-primary" onclick="addNewTask()">Ment√©s a Felh≈ëbe</button>
            </div>
            
            <h3>Mentett Feladatok</h3>
            <div id="manage-list"></div>
            
            <div style="margin-top: 30px; border-top:1px solid #ddd; padding-top:20px;">
                <button class="btn-danger" onclick="logout()">üö™ Kil√©p√©s</button>
            </div>
        </div>

        <div id="tab-info" class="tab-content">
            <div class="card">
                <h3>‚ÑπÔ∏è Inform√°ci√≥</h3>
                <p>Ez az alkalmaz√°s a <b>Pantry Cloud</b> szolg√°ltat√°st haszn√°lja a szinkroniz√°l√°shoz.</p>
                <p><b>Pantry ID:</b> <span id="display-pantry-id" style="font-family:monospace; background:#eee; padding:2px;"></span></p>
                <p>A fenti k√≥dnak minden csal√°dtag telefonj√°n egyeznie kell!</p>
                <button class="btn-danger" style="margin-top:10px;" onclick="forceSync()">üîÑ K√©nyszer√≠tett Szinkroniz√°l√°s MOST</button>
            </div>
        </div>
    </div>
</div>

<nav>
    <div class="nav-item active" onclick="switchTab('tab-today', this)"><span class="nav-icon">üìÖ</span> Ma</div>
    <div class="nav-item" onclick="switchTab('tab-settings', this)"><span class="nav-icon">‚öôÔ∏è</span> Be√°ll.</div>
    <div class="nav-item" onclick="switchTab('tab-info', this)"><span class="nav-icon">‚ÑπÔ∏è</span> Inf√≥</div>
</nav>

<script>
    // --- KONFIGUR√ÅCI√ì (Jav√≠tott URL) ---
    const PANTRY_BASE = "https://getpantry.cloud/apiv1/pantry/";
    const BASKET_NAME = "MyFamilyTasks"; 

    // --- √ÅLLAPOT ---
    let state = {
        user: localStorage.getItem('pantry_user') || '',
        pantryId: localStorage.getItem('pantry_id') || '',
        tasks: [],      // Feladat defin√≠ci√≥k
        dailyLog: {},   // Napl√≥: { "2023-10-27": [items...] }
        categories: [],
        currentDateObj: new Date()
    };

    // --- IND√çT√ÅS ---
    if(state.user && state.pantryId) {
        document.getElementById('user-name').value = state.user;
        document.getElementById('pantry-id').value = state.pantryId;
        startApp();
    }

    function login() {
        const u = document.getElementById('user-name').value.trim();
        const pid = document.getElementById('pantry-id').value.trim();
        
        if(!u || !pid) return alert("K√©rlek t√∂lts ki mindent!");
        
        state.user = u;
        state.pantryId = pid;
        
        localStorage.setItem('pantry_user', u);
        localStorage.setItem('pantry_id', pid);
        
        startApp();
    }

    function logout() {
        if(confirm("Kil√©p√©s? A Pantry ID t√∂rl≈ëdik a telefonr√≥l.")) {
            localStorage.clear();
            location.reload();
        }
    }

    function startApp() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        
        // Adatok ki√≠r√°sa a fejl√©cbe
        document.getElementById('user-display').innerText = `üë§ ${state.user}`;
        document.getElementById('sticky-pantry-id').innerText = `ID: ${state.pantryId}`;
        
        document.getElementById('display-pantry-id').innerText = state.pantryId;
        
        updateDateDisplay();
        
        // ELS≈ê LET√ñLT√âS
        fetchData();
        
        // AUTOMATIKUS SZINKRONIZ√ÅL√ÅS (5 m√°sodpercenk√©nt)
        setInterval(fetchData, 5000);
    }

    // --- KOMMUNIK√ÅCI√ì A FELH≈êVEL (Pantry API) ---
    
    async function fetchData() {
        updateSyncStatus('syncing');
        const url = `${PANTRY_BASE}${state.pantryId}/basket/${BASKET_NAME}`;
        
        try {
            const res = await fetch(url);
            if (!res.ok) {
                // Ha m√©g nem l√©tezik a kos√°r, l√©trehozzuk √ºresen
                if(res.status === 400 || res.status === 404) {
                    await saveData(true); // K√©nyszer√≠tett ment√©s az √ºres √°llapottal
                    return;
                }
                throw new Error("Hiba a let√∂lt√©skor");
            }
            const data = await res.json();
            
            // Adatok friss√≠t√©se
            state.tasks = data.tasks || [];
            state.dailyLog = data.dailyLog || {};
            state.categories = data.categories || [];
            
            renderManageList();
            renderToday();
            updateSyncStatus('online');
            
        } catch (e) {
            console.error(e);
            updateSyncStatus('error');
        }
    }

    async function saveData(isInit = false) {
        updateSyncStatus('syncing');
        const url = `${PANTRY_BASE}${state.pantryId}/basket/${BASKET_NAME}`;
        
        const payload = {
            tasks: state.tasks,
            dailyLog: state.dailyLog,
            categories: state.categories,
            lastUpdate: Date.now()
        };

        try {
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if(res.ok) {
                updateSyncStatus('online');
                if(!isInit) renderToday(); // UI friss√≠t√©se
            } else {
                throw new Error("Ment√©si hiba");
            }
        } catch(e) {
            console.error(e);
            updateSyncStatus('error');
            alert("Hiba a ment√©sn√©l! Ellen≈ërizd az internetet vagy a Pantry ID-t.");
        }
    }

    function updateSyncStatus(s) {
        const el = document.getElementById('sync-status');
        if(s==='syncing') { el.innerText = 'Szinkron...'; el.className = 'sync-badge'; }
        else if(s==='online') { el.innerText = 'Felh≈ë OK'; el.className = 'sync-badge active'; }
        else { el.innerText = 'Hiba'; el.style.background='red'; el.style.color='white'; }
    }
    
    function forceSync() { fetchData(); alert("Adatok friss√≠tve a felh≈ëb≈ël."); }

    // --- NAPI N√âZET LOGIKA ---

    function getTodayStr() {
        return state.currentDateObj.toISOString().split('T')[0];
    }

    function renderToday() {
        const list = document.getElementById('task-list'); list.innerHTML = '';
        const todayStr = getTodayStr();
        
        // 1. Megl√©v≈ë napl√≥bejegyz√©sek bet√∂lt√©se
        let dailyItems = state.dailyLog[todayStr] || [];
        
        // 2. Gener√°l√°s a defin√≠ci√≥kb√≥l (ha hi√°nyzik)
        state.tasks.forEach(t => {
            // Ha ez a feladat m√©g nincs benne a mai napl√≥ban
            const exists = dailyItems.some(i => i.taskId === t.id);
            if (!exists && isTaskDue(t, state.currentDateObj)) {
                dailyItems.push({
                    taskId: t.id,
                    name: t.name,
                    cat: t.cat || 'Egy√©b',
                    status: 'todo',
                    desc: describeFreq(t),
                    plannedBy: null
                });
            }
        });
        
        // Ha v√°ltozott a lista (gener√°ltunk √∫jat), ments√ºk el a mem√≥ri√°ba (√©s majd a felh≈ëbe)
        if (JSON.stringify(state.dailyLog[todayStr]) !== JSON.stringify(dailyItems)) {
            state.dailyLog[todayStr] = dailyItems;
        }

        let doneCount = 0;
        let totalCount = 0;

        dailyItems.forEach((item, idx) => {
            if(item.status !== 'skipped') {
                totalCount++;
                if(item.status === 'done') doneCount++;
            }

            let statusClass = item.status === 'done' ? 'status-done' : (item.status === 'skipped' ? 'status-skipped' : 'status-todo');
            let btns = '';
            
            if(item.status === 'done') {
                btns = `<div style="margin-top:10px; font-weight:bold; color:#00b894;">‚úÖ K√©sz: ${item.doneBy || '?'}</div>`;
            } else if (item.status === 'skipped') {
                btns = `<div style="margin-top:10px; font-style:italic;">üö´ Kihagyva</div>`;
            } else {
                btns = `
                <div class="btn-row">
                    <button class="btn-skip" onclick="updateTaskStatus('${todayStr}', ${idx}, 'skipped')">üö´</button>
                    <button class="btn-done" onclick="updateTaskStatus('${todayStr}', ${idx}, 'done')">‚úî K√©sz</button>
                </div>`;
            }

            list.innerHTML += `
            <div class="card ${statusClass}">
                <div class="task-header">
                    <div>
                        <div class="task-cat">${item.cat}</div>
                        <div class="task-name">${item.name}</div>
                        <div class="task-detail">${item.desc}</div>
                    </div>
                </div>
                ${btns}
            </div>`;
        });

        document.getElementById('empty-msg').style.display = (dailyItems.length > 0 && totalCount === doneCount && totalCount > 0) ? 'block' : 'none';
    }

    function updateTaskStatus(dateStr, idx, newStatus) {
        if (!state.dailyLog[dateStr]) return;
        state.dailyLog[dateStr][idx].status = newStatus;
        if (newStatus === 'done') state.dailyLog[dateStr][idx].doneBy = state.user;
        
        renderToday(); // Azonnali UI friss√≠t√©s
        saveData();    // K√ºld√©s a felh≈ëbe
    }

    // --- FELADAT MENT√âSE ---
    
    function addNewTask() {
        const name = document.getElementById('new-name').value;
        if(!name) return alert("N√©v k√∂telez≈ë!");
        
        const cat = document.getElementById('new-cat').value;
        const type = document.getElementById('freq-type').value;
        const todayISO = new Date().toISOString();

        let taskObj = {
            id: 't_' + Date.now(),
            name, cat, freqType: type,
            created: todayISO,
            startDate: todayISO
        };

        // Adatgy≈±jt√©s t√≠pus alapj√°n
        if (type === 'weekly_days') {
            let days = [];
            document.querySelectorAll('#opt-weekly-days .day-btn.selected').forEach(el => {
                const txt = el.innerText;
                if(txt=='V') days.push(0); if(txt=='H') days.push(1); if(txt=='K') days.push(2);
                if(txt=='Sz') days.push(3); if(txt=='Cs') days.push(4); if(txt=='P') days.push(5); if(txt=='Szo') days.push(6);
            });
            if(days.length === 0) return alert("V√°lassz legal√°bb egy napot!");
            taskObj.days = days;
        } 
        else if (type === 'interval_week') taskObj.interval = parseInt(document.getElementById('interval-week-num').value);
        else if (type === 'monthly_fix') taskObj.monthDay = parseInt(document.getElementById('month-day-fix').value);
        else if (type === 'interval_month') taskObj.interval = parseInt(document.getElementById('interval-month-num').value);
        else if (type === 'monthly_pattern') {
            taskObj.posNum = parseInt(document.getElementById('month-pos-num').value);
            taskObj.posDay = parseInt(document.getElementById('month-pos-day').value);
        }

        // Kateg√≥ria
        if(cat && !state.categories.includes(cat)) {
            state.categories.push(cat);
        }

        // Hozz√°ad√°s
        state.tasks.push(taskObj);
        
        // Ment√©s
        saveData();
        
        alert("Feladat mentve a felh≈ëbe!");
        document.getElementById('new-name').value = '';
    }

    function deleteTask(id) {
        if(confirm("T√∂rl√∂d?")) {
            state.tasks = state.tasks.filter(t => t.id !== id);
            saveData();
        }
    }

    // --- D√ÅTUM LOGIKA ---
    function isTaskDue(t, checkDate) {
        checkDate.setHours(0,0,0,0);
        const dayOfWeek = checkDate.getDay(); 
        const dateNum = checkDate.getDate();
        
        if (t.freqType === 'every_day') return true;
        if (t.freqType === 'weekly_days') return (t.days && t.days.includes(dayOfWeek));
        
        if (t.freqType === 'interval_week') {
            const start = new Date(t.startDate); start.setHours(0,0,0,0);
            const diffDays = Math.round((checkDate - start) / (24 * 60 * 60 * 1000));
            return (diffDays >= 0 && diffDays % (t.interval * 7) === 0);
        }
        if (t.freqType === 'monthly_fix') return (dateNum == t.monthDay);
        // ... (t√∂bbi logika ugyanaz)
        return false;
    }

    function describeFreq(t) {
        if(t.freqType === 'every_day') return 'Naponta';
        if(t.freqType === 'weekly_days') return 'Heti napokon';
        return 'Id≈ëszakos';
    }

    // --- UI SEG√âDEK ---
    function changeDay(offset) {
        state.currentDateObj.setDate(state.currentDateObj.getDate() + offset);
        updateDateDisplay();
        renderToday();
    }
    
    function updateDateDisplay() {
        document.getElementById('today-date').innerText = state.currentDateObj.toLocaleDateString('hu-HU', {weekday:'long', month:'long', day:'numeric'});
    }

    function renderManageList() {
        const div = document.getElementById('manage-list'); div.innerHTML = '';
        state.tasks.forEach(t => {
            div.innerHTML += `<div class="card" style="display:flex; justify-content:space-between;"><div><b>${t.name}</b><br><small>${t.cat}</small></div><button class="btn-danger" style="flex:0; padding:5px 15px;" onclick="deleteTask('${t.id}')">üóëÔ∏è</button></div>`;
        });
    }

    function renderFreqOptions() {
        const type = document.getElementById('freq-type').value;
        ['opt-weekly-days','opt-interval-week','opt-monthly-fix','opt-interval-month','opt-monthly-pattern'].forEach(id => document.getElementById(id).style.display = 'none');
        if(type === 'weekly_days') document.getElementById('opt-weekly-days').style.display = 'block';
        if(type === 'interval_week') document.getElementById('opt-interval-week').style.display = 'block';
        if(type === 'monthly_fix') document.getElementById('opt-monthly-fix').style.display = 'block';
        if(type === 'interval_month') document.getElementById('opt-interval-month').style.display = 'block';
        if(type === 'monthly_pattern') document.getElementById('opt-monthly-pattern').style.display = 'block';
    }
    function toggleDay(el) { el.classList.toggle('selected'); }
    function renderCategoryChips() { const c = document.getElementById('cat-chips'); c.innerHTML = ''; state.categories.forEach(cat => c.innerHTML += `<div class="chip" onclick="document.getElementById('new-cat').value='${cat}'">${cat}</div>`); }
    function filterCats() { renderCategoryChips(); }

    window.switchTab = function(id, el) {
        document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active')); document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active')); if(el) el.classList.add('active');
    }
</script>
</body>
</html>
